# 前端监控及错误上报
> 引言：
> 1. 什么项目是好的前端项目？用户的评价才是最重要的。

1. 最基本的功能；
2. 稳定可靠；
3. 良好交互用户体验；
4. 复用性；
5. 可控，可监控；
6. lint；
7. 模块化；
8. 按需加载；
9. 非核心组件异步组件；(图层及布局异步加载)
10. 代码分割减少bundle.js文件的大小；
11. 规范管理依赖；
12. 最重要的是Bug率；
13. 保证10分钟定位问题；快速定位问题，自动监控；
14. 保证30分钟解决问题；
15. 从运营的角度来考虑问题，来汇报工作；
16. 技术运营，如何让自己的技术可控；
17. 前端的测试很困难，网络情况、用户系统、用户体验、事件交互；
18. Bug一定会出现，关键是如何快速定位？快速解决？

> 2. 用户体验和开发效率哪个更重要？具体分析。
> 3. B端和C端的需求不同
> 4. 前端的方向？数据可视化；物联网？大数据？echarts hightchart D3.js Three.js

***
## 1. 监控分类
### 1.1 技术监控

*1.1.1 页面性能*
> 页面加载时长；
> 首屏加载时间；

*1.1.2 静态资源*
> CSS 

> JS

> image

> video

*1.1.3 错误监控*
> http 链接 

*1.1.4 接口性能*

### 1.2 行为监控

*1.2.1 用户行为路径*
> 最好的方式是了解操作流程；如录屏；

> 支付功能：至关重要；aliPay、weChat、ApplePay、payPal等

> 重点页面重点监控：了解用户行为；根据用户点击行为推荐用户行为；

*1.2.2 打点监控*
> 监控页面功能用户使用的频次；

> 通过数据决定页面布局；

*1.2.3 大量log上报策略*
> 必须对数据进行筛选，不应该全部上传；

> 前端随机选择数据，但是后端可以更加配置文件更改配置项；

> 日志上报；

> 服务端只能通过日志进行上报；

*1.2.4 时效性能*

### 1.3 非技术领导面试的需求；
> 1. 数据结构和算法；
> 2. 对前端的理解；
> 3. 如何保证前端页面的性能；
> 4. 前端团队的培养；
> 5. 网站的性能优化？优化策略及方案；

### 1.4 缺少前端监控统一规范；

> 技术难点：1. 源码解析；React Vue Webpack Node.js等
> 技术难点：2. 数据结构及算法；


## 2. 自己搭建监控系统，属于业务逻辑的难度。

> 浏览器模拟网速插件；
> 1. 快速创建写监控代码；
> 2. 上线测试；
> 3. 迭代修改；


### 2.1 数据收集；client
### 2.2 数据统计；server 去掉极端数据；
### 2.3 数据分析；server
### 2.4 数据反馈；server: email mesage
### 2.5 数据展示；client: website

> rollup适合类库的打包、parcel webpack适合业务的打包  javascript 打包工具 

## 3. 用DOM自带的API performance
> window.onload 等页面所有资源都加载完成
> DOMcontent.onload ：只要DOM框架加载完就会触发，不会等待所有静态资源的加载完成（如image的src等）

> 1. performance.timing 页面性能监控
> 2. performance.getEntries()资源监控

### 3.1 项目结构及说明

> 0. dist/
> 1. eagle-sdk/  所有用的sdk资源，用rollup进行打包
> 2. eagle-server/ 
> 3. website/  网站数据，koa起一个服务器；并用koa-static起一个静态服务器
> 4. website/client  用koa-static起一个静态服务器,指向到client文件夹下面
> 5. website/client/script  测试及开发时用到是js数据
> 6. 要考虑用户在onload之前可能关闭页面，该如何考虑？

> Tips: 性能监控脚本一定放到html的最上方最先加载，否则监控不完全。

### 3.2 PerformanceObserver mdn 
### 3.3 资源监控
#### 需要明确，并不是所有的资源都必须监控，只对核心的资源加载进行监控，否则上传的数据量太大了。

### 3.4 面向切片的编程：监控ajax请求性能
> XMLHttpRequest 
> fetch
> mock.js 重写了XMLHttpRequest. open send程序

> try catch 自定义错误类型，进行统一处理
> 对监控程序本身报错的处理，如果监控程序本身出现问题，需要特别注意

### 3.5 把用户数据记录在用户本地电脑中
> indexDB数据库存在本地；
> 进行一个长连接，当用户在线，需要的时候，远程可以获取数据；

### 3.6 window.onerror 利用浏览器的错误处理
> 各浏览器的兼容性不一样，报错的准确性不同

### 3.7 利用三方类库
> fundebug
> source-map 线上需求对代码进行压缩，需要进行错误反解，对错误进行定位
> react vue 等框架混淆或者压缩后，浏览器报错，都在bundle.js中，我们需要反解到源代码中；

### 3.8 打点上报
> 通过api调用，在需要监控的位置进行调用，向服务端上传数据；

### 3.9 report模块
```
new Image('')
```

### 3.10 先从性能监控开始；

### 3.11 再对错误进行监控和上报；

### 4. 前端数据展示




